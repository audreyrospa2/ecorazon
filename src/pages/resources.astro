---
import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Get all published blog posts, sorted by date (newest first)
const allPosts = await getCollection('blog', ({ data }: CollectionEntry<'blog'>) => {
  return data.draft !== true;
});

const sortedPosts = allPosts.sort((a: CollectionEntry<'blog'>, b: CollectionEntry<'blog'>) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

// Featured posts (first 2)
const featuredPosts = sortedPosts.slice(0, 2);

// Latest posts (next 6)
const latestPosts = sortedPosts.slice(2, 8);

// Format date helper
function formatDate(date: Date) {
  return new Intl.DateTimeFormat('en-US', { 
    year: 'numeric', 
    month: 'short' 
  }).format(new Date(date));
}

// Category color helper
function getCategoryColor(category: string) {
  const colors: Record<string, string> = {
    'Artist Stories': 'bg-cork-brown',
    'Materials': 'bg-forest-green',
    'Impact': 'bg-deep-olive',
    'Partnerships': 'bg-deep-olive',
    'Tips': 'bg-forest-green',
    'Innovation': 'bg-cork-brown',
    'Community': 'bg-deep-olive',
  };
  return colors[category] || 'bg-forest-green';
}
---

<Layout title="Resources - EcorazÃ³n">
  <Header />
  
  <main>
    <!-- Hero Section -->
    <section class="bg-gradient-to-br from-warm-beige to-gray-100 py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-forest-green mb-6 animate-fade-in">
          Resources
        </h1>
        <p class="text-xl text-gray-700 max-w-3xl mx-auto animate-fade-in-delay">
          Stay updated with the latest stories, insights, and discoveries from our journey of empowerment and sustainability
        </p>
      </div>
    </section>

    <!-- Introduction Section -->
    <section class="py-16 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-16">
          <h2 class="text-3xl md:text-4xl font-bold text-forest-green mb-6 intro-title">
            Learn, Discover, Get Inspired
          </h2>
          <p class="text-lg text-gray-700 max-w-4xl mx-auto leading-relaxed intro-text">
            Stay updated with the latest news, blogs, and stories from EcorazÃ³n. Learn more about our journey, materials, and how we're making a difference in the world of sustainable corporate gifting and artist empowerment.
          </p>
        </div>
      </div>
    </section>

    <!-- Featured Content Section -->
    {featuredPosts.length > 0 && (
      <section class="py-16 bg-warm-beige">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="mb-12">
            <h2 class="text-3xl font-bold text-forest-green mb-8 featured-title">Featured Articles</h2>
          </div>
          
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            {featuredPosts.map((post: CollectionEntry<'blog'>) => (
              <div class="bg-white rounded-lg shadow-sm overflow-hidden featured-card">
                <img 
                  src={post.data.image} 
                  alt={post.data.imageAlt} 
                  class="w-full h-48 object-cover"
                />
                <div class="p-8">
                  <div class="flex items-center mb-4">
                    <span class={`${getCategoryColor(post.data.category)} text-white px-3 py-1 rounded-full text-sm font-medium mr-3`}>
                      {post.data.category}
                    </span>
                    <span class="text-gray-500 text-sm">{formatDate(post.data.date)}</span>
                  </div>
                  <h3 class="text-2xl font-bold text-forest-green mb-4">
                    {post.data.title}
                  </h3>
                  <p class="text-gray-700 leading-relaxed mb-6">
                    {post.data.excerpt}
                  </p>
                  <a href={`/blog/${post.slug}`} class="text-forest-green font-semibold hover:text-deep-olive transition-colors link-hover">
                    Read More â†’
                  </a>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Blog Grid Section -->
    {latestPosts.length > 0 && (
      <section class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="mb-12">
            <h2 class="text-3xl font-bold text-forest-green mb-8 latest-title">Latest Stories</h2>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {latestPosts.map((post: CollectionEntry<'blog'>) => (
              <div class="bg-warm-beige rounded-lg overflow-hidden blog-card">
                <img 
                  src={post.data.image} 
                  alt={post.data.imageAlt} 
                  class="w-full h-40 object-cover"
                />
                <div class="p-6">
                  <div class="flex items-center mb-3">
                    <span class={`${getCategoryColor(post.data.category)} text-white px-2 py-1 rounded text-xs font-medium mr-2`}>
                      {post.data.category}
                    </span>
                    <span class="text-gray-500 text-xs">{formatDate(post.data.date)}</span>
                  </div>
                  <h4 class="text-lg font-semibold text-forest-green mb-3">
                    {post.data.title}
                  </h4>
                  <p class="text-gray-700 text-sm mb-4">
                    {post.data.excerpt}
                  </p>
                  <a href={`/blog/${post.slug}`} class="text-forest-green font-medium text-sm hover:text-deep-olive transition-colors link-hover">
                    Read Story â†’
                  </a>
                </div>
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- Newsletter Section -->
    <section class="py-16 bg-forest-green text-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center">
          <h2 class="text-3xl md:text-4xl font-bold mb-6 newsletter-title">
            Stay Updated
          </h2>
          <p class="text-xl text-gray-200 mb-8 max-w-2xl mx-auto newsletter-text">
            Subscribe to our newsletter to receive the latest stories, sustainability tips, and updates from the EcorazÃ³n community.
          </p>
          
          <div class="max-w-md mx-auto newsletter-form">
            <form class="flex gap-4">
              <input 
                type="email" 
                placeholder="Enter your email" 
                class="flex-1 px-4 py-3 rounded-md text-gray-800 focus:outline-none focus:ring-2 focus:ring-white"
                required
              />
              <button 
                type="submit"
                class="bg-white text-forest-green px-6 py-3 rounded-md font-semibold transition-all duration-300 btn-float-white"
              >
                Subscribe
              </button>
            </form>
            <p class="text-gray-300 text-sm mt-4">
              We respect your privacy. Unsubscribe at any time.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Resource Categories Section -->
    <section class="py-16 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl md:text-4xl font-bold text-forest-green mb-6 category-title">
            Explore by Category
          </h2>
          <p class="text-lg text-gray-700 max-w-3xl mx-auto category-text">
            Find the content that interests you most
          </p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <a href="#" class="bg-warm-beige p-6 rounded-lg text-center transition-all duration-300 category-card">
            <div class="text-3xl mb-3">ðŸŒ±</div>
            <h3 class="text-lg font-semibold text-forest-green mb-2">Sustainability</h3>
            <p class="text-gray-600 text-sm">Environmental practices and eco-friendly materials</p>
          </a>
          
          <a href="#" class="bg-warm-beige p-6 rounded-lg text-center transition-all duration-300 category-card">
            <div class="text-3xl mb-3">ðŸŽ¨</div>
            <h3 class="text-lg font-semibold text-forest-green mb-2">Artist Stories</h3>
            <p class="text-gray-600 text-sm">Meet the talented creators behind our work</p>
          </a>
          
          <a href="#" class="bg-warm-beige p-6 rounded-lg text-center transition-all duration-300 category-card">
            <div class="text-3xl mb-3">ðŸ’¼</div>
            <h3 class="text-lg font-semibold text-forest-green mb-2">Corporate Impact</h3>
            <p class="text-gray-600 text-sm">ESG strategies and business partnerships</p>
          </a>
          
          <a href="#" class="bg-warm-beige p-6 rounded-lg text-center transition-all duration-300 category-card">
            <div class="text-3xl mb-3">ðŸ’¡</div>
            <h3 class="text-lg font-semibold text-forest-green mb-2">Innovation</h3>
            <p class="text-gray-600 text-sm">New materials and creative techniques</p>
          </a>
        </div>
      </div>
    </section>

    <!-- Call-to-Action Section -->
    <section class="py-16 bg-warm-beige">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-forest-green mb-6 cta-title">
          Have a Story to Share?
        </h2>
        <p class="text-xl text-gray-700 mb-8 max-w-2xl mx-auto cta-text">
          We'd love to hear from you. Whether you have a collaboration idea, a sustainability tip, or want to share your experience with EcorazÃ³n.
        </p>
        <div class="cta-button">
          <a href="/contact" class="inline-block bg-forest-green text-white px-8 py-3 rounded-md text-lg font-semibold transition-all duration-300 btn-float">
            Get in Touch
          </a>
        </div>
      </div>
    </section>
  </main>
  
  <Footer />
</Layout>

<style>
  /* Hero animations - load immediately */
  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeInDown 0.8s ease-out 0.2s both;
  }

  .animate-fade-in-delay {
    animation: fadeInDown 0.8s ease-out 0.4s both;
  }

  /* Scroll-triggered animations */
  .intro-title,
  .intro-text,
  .featured-title,
  .featured-card,
  .latest-title,
  .blog-card,
  .newsletter-title,
  .newsletter-text,
  .newsletter-form,
  .category-title,
  .category-text,
  .category-card,
  .cta-title,
  .cta-text,
  .cta-button {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.8s ease-out, transform 0.8s ease-out;
  }

  .intro-title.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.1s;
  }

  .intro-text.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.2s;
  }

  .featured-title.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.1s;
  }

  .featured-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .featured-card:nth-child(1).visible {
    transition-delay: 0.1s;
  }

  .featured-card:nth-child(2).visible {
    transition-delay: 0.3s;
  }

  .latest-title.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.1s;
  }

  .blog-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .blog-card:nth-child(1).visible {
    transition-delay: 0.1s;
  }

  .blog-card:nth-child(2).visible {
    transition-delay: 0.2s;
  }

  .blog-card:nth-child(3).visible {
    transition-delay: 0.3s;
  }

  .blog-card:nth-child(4).visible {
    transition-delay: 0.4s;
  }

  .blog-card:nth-child(5).visible {
    transition-delay: 0.5s;
  }

  .blog-card:nth-child(6).visible {
    transition-delay: 0.6s;
  }

  .newsletter-title.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.1s;
  }

  .newsletter-text.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.2s;
  }

  .newsletter-form.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.3s;
  }

  .category-title.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.1s;
  }

  .category-text.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.2s;
  }

  .category-card.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .category-card:nth-child(1).visible {
    transition-delay: 0.1s;
  }

  .category-card:nth-child(2).visible {
    transition-delay: 0.2s;
  }

  .category-card:nth-child(3).visible {
    transition-delay: 0.3s;
  }

  .category-card:nth-child(4).visible {
    transition-delay: 0.4s;
  }

  .cta-title.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.1s;
  }

  .cta-text.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.2s;
  }

  .cta-button.visible {
    opacity: 1;
    transform: translateY(0);
    transition-delay: 0.3s;
  }

  /* Hover effects */
  .featured-card {
    transition: opacity 0.8s ease-out, transform 0.8s ease-out, box-shadow 0.3s ease;
    cursor: pointer;
  }

  .featured-card:hover {
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    transform: translateY(-10px);
  }

  .featured-card img {
    transition: transform 0.3s ease;
  }

  .featured-card:hover img {
    transform: scale(1.08);
  }

  .blog-card {
    transition: opacity 0.8s ease-out, transform 0.8s ease-out, box-shadow 0.3s ease;
    cursor: pointer;
  }

  .blog-card:hover {
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
    transform: translateY(-10px);
  }

  .blog-card img {
    transition: transform 0.3s ease;
  }

  .blog-card:hover img {
    transform: scale(1.08);
  }

  .category-card:hover {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    transform: translateY(-8px);
  }

  /* Link hover effects */
  .link-hover {
    display: inline-block;
    transition: transform 0.3s ease;
  }

  .link-hover:hover {
    transform: translateX(5px);
  }

  /* Button float effects */
  .btn-float {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .btn-float:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    background-color: #556B2F;
  }

  .btn-float-white {
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
  }

  .btn-float-white:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    background-color: #f3f4f6;
  }

  /* Smooth scrolling */
  html {
    scroll-behavior: smooth;
  }
</style>

<script>
  // Intersection Observer for scroll animations
  const observerOptions = {
    threshold: 0.2,
    rootMargin: '0px 0px -50px 0px'
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
      }
    });
  }, observerOptions);

  // Observe all animated elements
  document.addEventListener('DOMContentLoaded', () => {
    const elementsToAnimate = document.querySelectorAll(
      '.intro-title, .intro-text, .featured-title, .featured-card, .latest-title, .blog-card, .newsletter-title, .newsletter-text, .newsletter-form, .category-title, .category-text, .category-card, .cta-title, .cta-text, .cta-button'
    );
    
    elementsToAnimate.forEach(el => observer.observe(el));
  });
</script>